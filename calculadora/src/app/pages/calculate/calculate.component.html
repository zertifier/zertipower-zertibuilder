<!-- HEADER CALCULATE -->

<div class="header-calculate d-flex align-items-center w-100 px-1 px-md-5 row m-0">

    <div class="d-none d-md-block col-12 col-md-6 logo-zertipower-container py-3">
        <img src="assets/img/navbar/zertipower-logo-white.png" class="w-100" alt="zertipower-logo"
            style="max-width:300px;">
    </div>

    <div class="d-block d-md-none col-12 logo-zertipower-container d-flex justify-content-center py-3">
        <img src="assets/img/navbar/zertipower-logo-white.png" class="w-100" alt="zertipower-logo"
            style="max-width:300px;">
    </div>

    <div class="d-none d-md-block col-6 eslogan text-white text-end">
        Uneix-te a la transició col·lectiva
    </div>

    <div class="d-block d-md-none col-12 eslogan text-white text-center pb-3">Uneix-te a la transició col·lectiva</div>
</div>

<div class="my-4 p-4">
    <h4 class="h4 d-flex justify-content-center">Calcula el teu estalvi energètic en 6 passos</h4>
    <span class="d-flex justify-content-center">Explora i edita les pestanyes. Recorda que pots saltar d'una pestanya a
        una altre per a editar la informació abans de guardar</span>
</div>

<!-- END HEADER CALCULATE -->

<div class="container">

    <div class="card p-2 p-md-5 mb-5">

        <!-- SELECT ZONE -->

        <div id="collapser-1" class="d-flex align-items-center w-100 mb-2 mb-md-4 collapser" data-bs-toggle="collapse"
            data-bs-target="#collapse-location-step" aria-expanded="false" aria-controls="collapse-location-step"
            (click)="changeStep(1)">

            <div class="p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive!=1 ? 'bi bi-chevron-right' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708" />
                </svg>

                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive==1 ? 'bi bi-chevron-down' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />
                </svg>
            </div>

            <div [ngClass]=getStepClasses(1)>

                <div class="d-flex justify-content-between align-items-center w-100">

                    <span>
                        {{steps[0]}}
                    </span>

                    <!-- check step 0 -->
                    <div [ngClass]="stepsCompleted[0] ? 'd-block d-flex align-items-center' : 'd-none'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#229954"
                            class="bi bi-check-circle-fill success" viewBox="0 0 16 16">
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                        </svg>
                    </div>

                </div>

            </div>

        </div>

        <!-- SELECT ZONE COLAPSE -->

        <div class="collapse" [ngClass]="{'show':stepActive==1}" id="collapse-location-step">
            <div class="section-content-padding">

                <span> Selecciona una població dins de la comunitat energètica.</span>

                <!-- {{selectedLocation | json}} -->

                <div class="col-12 col-md-6 mt-2">
                    <select id="location" [(ngModel)]="selectedLocation" class="form-select px-2"
                        (ngModelChange)="selectLocation($event)">
                        <option *ngFor="let location of locations" [ngValue]="location">{{location.municipality}}
                        </option>
                    </select>
                </div>

                <div class="d-flex justify-content-between mt-2 mt-md-4 mb-2 mb-md-4 ">

                    <a class="d-flex">
                    </a>

                    <a class="d-flex" (click)="changeStep(2)" role="button">
                        <span class="me-2">Endavant</span>

                        <div class="arrow-right">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8" />
                            </svg>
                        </div>
                    </a>

                </div>
            </div>
        </div>

        <!-- SELECT COMMUNITY -->

        <div id="collapser-2" class="d-flex align-items-center w-100  mb-2 mb-md-4 collapser" (click)="changeStep(2)">

            <div class="p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive!=2 ? 'bi bi-chevron-right' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708" />
                </svg>

                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive==2 ? 'bi bi-chevron-down' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />
                </svg>
            </div>

            <div [ngClass]="getStepClasses(2)">

                <div class="d-flex justify-content-between align-items-center w-100">

                    <span>
                        {{steps[1]}}
                    </span>

                    <!-- check step 1 -->
                    <div [ngClass]="stepsCompleted[1] ? 'd-block d-flex align-items-center' : 'd-none'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#229954"
                            class="bi bi-check-circle-fill success" viewBox="0 0 16 16">
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                        </svg>
                    </div>

                </div>

            </div>

        </div>

        <!-- SELECT COMMUNITY COLAPSE -->

        <div class="collapse" id="collapse-community-selection-step" [ngClass]="{'show':stepActive==2}">
            <div class="section-content-padding row">

                <span class="col-12">Tria una comunitat de la llista o fes clic en la ubicació del mapa. També podràs
                    crear una nova comunitat.</span>

                <div class="col-12 col-md-4 mt-2 mt-md-4 d-flex align-items-center">
                    <span *ngIf="selectedLocation">Població seleccionada: {{this.selectedLocation.municipality}}</span>
                </div>

                <div class="col-12 col-md-4 mt-2 mt-md-4 d-flex align-items-center">
                    <select *ngIf="selectedCommunity!=newCommunity" id="location-comunnity"
                        [(ngModel)]="selectedCommunity" class="form-select px-2"
                        (ngModelChange)="OnSelectorChange($event, 'community')">
                        <option [ngValue]="null" disabled selected hidden>Triar comunitat</option>
                        <option *ngFor="let community of selectedCommunities" [ngValue]="community">{{ community.name }}
                        </option>
                    </select>

                    <select *ngIf="selectedCommunity==newCommunity" id="location-comunnity"
                        [(ngModel)]="selectedCommunity" class="form-select px-2"
                        (change)="OnSelectorChange(selectedCommunity,'community')" autofocus>
                        <option [ngValue]="newCommunity">Nova comunitat</option>
                        <option *ngFor="let community of selectedCommunities" [ngValue]="community">{{ community.name }}
                        </option>
                    </select>
                </div>

                <div class="col-12 col-md-4 mt-2 mt-md-4 d-flex align-items-center ">
                    <button class="btn btn-primary" (click)="OnSelectorChange(newCommunity,'community')">Crear
                        comunitat</button>
                </div>

                <!-- TODO DECIDIR QUE FER -->
                <!-- <div class="w-100 mt-2 mt-md-4" style="height: 550px;">
                    <app-map class="w-100 h-100"></app-map>
                </div>  -->

                <div class="d-flex justify-content-between mt-2 mt-md-4 mb-2 mb-md-4 ">

                    <a class="d-flex" (click)="changeStep(1)" role="button">
                        <div class="arrow-left">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </div>
                        <span class="ms-2">Enrere</span>
                    </a>

                    <a class="d-flex" (click)="changeStep(3)" role="button">
                        <span class="me-2">Endavant</span>

                        <div class="arrow-right">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8" />
                            </svg>
                        </div>
                    </a>

                </div>
            </div>
        </div>

        <!-- COMMUNITY DATA -->

        <div id="collapser-3" class="d-flex align-items-center w-100  mb-2 mb-md-4 collapser" (click)="changeStep(3)">

            <div class="p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive!=3 ? 'bi bi-chevron-right' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708" />
                </svg>

                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive==3 ? 'bi bi-chevron-down' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />
                </svg>
            </div>

            <div [ngClass]="getStepClasses(3)">

                <div class="d-flex justify-content-between align-items-center w-100">

                    <span>
                        {{steps[2]}}
                    </span>

                    <!-- check step 2 -->
                    <div [ngClass]="stepsCompleted[2] ? 'd-block d-flex align-items-center' : 'd-none'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#229954"
                            class="bi bi-check-circle-fill success" viewBox="0 0 16 16">
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                        </svg>
                    </div>

                </div>

            </div>

        </div>

        <!-- COMMUNITY DATA COLAPSE -->

        <div class="collapse" id="collapse-community-data-step" [ngClass]="{'show':stepActive==3}">
            <div class="section-content-padding">

                Aquestes son les estadístiques de la comunitat.

                <div class="col-12 d-flex mt-2 mt-md-4">
                    <span class="d-flex align-items-center me-2">Membres:</span>
                    <span *ngIf="selectedCommunity">{{ communityCups.length || 0 }}</span>
                </div>

                <div class="col-12 d-flex mt-2 mt-md-4">
                    <span class="d-flex align-items-center me-2">Membres simulats: {{ addedAreas.length }}</span>
                </div>

                <div class="d-flex w-100 mb-2 mb-md-2 mt-2 mt-md-4">

                    <div *ngIf="!selectedCommunity || (!selectedCommunity.cups_number && !addedAreas.length)"
                        class="chart-message">Agrega àrees per
                        obtenir dades comunitàries
                    </div>

                    <div *ngIf="selectedCommunity && (selectedCommunity.cups_number || addedAreas.length)"
                        class="custom-chart mx-auto" style="width:95%; position:relative">
                        <app-chart [chartId]="'communityChart'" [chartType]="communityMonthChartType"
                            [labels]="monthChartLabels" [datasets]="communityMonthChartDatasets"
                            [options]="communityMonthChartOptions"
                            [updateSubject]="communityUpdateMonthChartSubject.asObservable()"></app-chart>
                    </div>

                </div>

                <div class="d-flex justify-content-between mt-2 mt-md-4 mb-2 mb-md-4 ">

                    <a class="d-flex" (click)="changeStep(2)" role="button">
                        <div class="arrow-left">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </div>
                        <span class="ms-2">Enrere</span>
                    </a>

                    <a class="d-flex" (click)="changeStep(4)" role="button">
                        <span class="me-2">Endavant</span>

                        <div class="arrow-right">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8" />
                            </svg>
                        </div>
                    </a>

                </div>
            </div>
        </div>

        <!-- SELECT AREA DATA -->

        <div id="collapser-4" class="d-flex align-items-center w-100  mb-2 mb-md-4 collapser" (click)="changeStep(4)">

            <div class="p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive!=4 ? 'bi bi-chevron-right' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708" />
                </svg>

                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive==4 ? 'bi bi-chevron-down' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />
                </svg>
            </div>

            <div [ngClass]="getStepClasses(4)">

                <div class="d-flex justify-content-between align-items-center w-100">

                    <span>
                        {{steps[3]}}
                    </span>

                    <!-- check step 3 -->
                    <div [ngClass]="stepsCompleted[3] ? 'd-block d-flex align-items-center' : 'd-none'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#229954"
                            class="bi bi-check-circle-fill success" viewBox="0 0 16 16">
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                        </svg>
                    </div>

                </div>

            </div>

        </div>

        <!-- SELECT AREA COLAPSE -->

        <div class="collapse" id="collapse-area-step" [ngClass]="{'show':stepActive==4}">
            <div class="section-content-padding row">

                <span>Fes click en una àrea per veure les seves dades i simular que passaria si s'afegeix a la
                    comunitat.</span>

                <div class="col-12 col-md-4 mt-2 mt-md-4 d-flex align-items-center">
                    <span *ngIf="selectedLocation">Població seleccionada: {{this.selectedLocation.municipality}}</span>
                </div>

                <div class="col-12 col-md-4 mt-2 mt-md-4 d-flex align-items-center">
                    <span *ngIf="!this.selectedCommunity || !this.selectedCommunity.name">Comunitat seleccionada: Nova
                        comunitat</span>
                    <span *ngIf="this.selectedCommunity && this.selectedCommunity.name">Comunitat seleccionada:
                        {{this.selectedCommunity.name}}</span>
                </div>

                <div class="w-100 mt-2 mt-md-4" style="height: 550px;">
                    <app-map [activeFeatures]="addedAreas" class="w-100 h-100"></app-map>
                </div>

                <div class="d-flex justify-content-between mt-2 mt-md-4 mb-2 mb-md-4 ">

                    <a class="d-flex" (click)="changeStep(3)" role="button">
                        <div class="arrow-left">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </div>
                        <span class="ms-2">Enrere</span>
                    </a>

                    <a class="d-flex" (click)="changeStep(5)" role="button">
                        <span class="me-2">Endavant</span>

                        <div class="arrow-right">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8" />
                            </svg>
                        </div>
                    </a>

                </div>
            </div>
        </div>

        <!-- CALCULATE AREA -->

        <div id="collapser-5" class="d-flex align-items-center w-100  mb-2 mb-md-4 collapser" (click)="changeStep(5)">

            <div class="p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive!=5 ? 'bi bi-chevron-right' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708" />
                </svg>

                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive==5 ? 'bi bi-chevron-down' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />
                </svg>
            </div>

            <div [ngClass]="getStepClasses(5)">

                <div class="d-flex justify-content-between align-items-center w-100">

                    <span>
                        {{steps[4]}}
                    </span>

                    <!-- check step 4 -->
                    <div [ngClass]="stepsCompleted[4] ? 'd-block d-flex align-items-center' : 'd-none'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#229954"
                            class="bi bi-check-circle-fill success" viewBox="0 0 16 16">
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                        </svg>
                    </div>

                </div>

            </div>

        </div>

        <!-- CALCULATE AREA COLAPSE -->

        <div class="collapse" id="collapse-calculate-step" [ngClass]="{'show':stepActive==5}">
            <div class="section-content-padding">

                <div class="w-100 d-flex mt-2 mt-md-4">
                    <span>Tria el tipus de consum que vols afegir</span>
                    <a *ngIf="!editingArea" class="d-flex w-100 justify-content-end" (click)="editingArea=true">
                        <span>Ajustar dades</span>
                    </a>
                </div>

                <div class="container d-flex justify-content-center align-items-center">
                    <div
                        class="d-flex flex-column flex-md-row justify-content-center align-items-center btn-container w-100">

                        <button type="button" class="btn w-md-auto m-2 m-md-4 w-100"
                            [ngClass]="activeCommunity?'bg-complement':'btn-secondary'" style="max-width: 300px;"
                            (click)="editingArea=false;activeIndividual=false;activeCommunity=true; simulateGenerationConsumption()">Estalvi
                            membre comunitari</button>

                        <button type="button" class="btn w-md-auto  m-2 m-md-4 w-100"
                            [ngClass]="activeIndividual?'bg-complement':'btn-secondary'" style="max-width: 300px;"
                            (click)="editingArea=false;activeIndividual=true;activeCommunity=false; simulateGenerationConsumption()">Estalvi
                            autoconsum</button>

                    </div>
                </div>

                <div class="collapse" id="collapse-edit-area-step" [ngClass]="{'show':editingArea}">

                    <div class="row">

                        <!-- metres quadrats -->
                        <div class="col-6 col-md-4 mt-2 mt-md-4">
                            <div>
                                <span>M² de l'àrea</span>
                            </div>
                            <div>
                                <input type="number" class="form-select number-input"
                                    [(ngModel)]="this.selectedCadastre.m2" (change)="updateCadastreChart()" min="0"
                                    step="0">
                            </div>
                        </div>

                        <div class="col-6 col-md-4 mt-2 mt-md-4">
                            <div>
                                <span>Inclinació del sostre</span>
                            </div>
                            <select id="inclinationSelector" class="form-select w-100"
                                [(ngModel)]="this.selectedCadastre.inclination">
                                <option *ngFor="let inclination of inclinations" [ngValue]="inclination.value">
                                    {{ inclination.name }}
                                </option>
                            </select>
                        </div>

                        <div class="col-6 col-md-4 mt-2 mt-md-4">
                            <div>
                                <span>Orientació</span>
                            </div>
                            <select id="orientationSelector" class="form-select w-100"
                                [(ngModel)]="this.selectedCadastre.orientation">
                                <option *ngFor="let orientation of orientations" [ngValue]="orientation.value">
                                    {{ orientation.name }}
                                </option>
                            </select>
                        </div>

                    </div>

                    <div class="row">
                        <div class="col mt-2 mt-md-4">
                            <div>
                                <span>Preu de l'energia sobrant. €/Kwh.</span>
                            </div>
                            <input *ngIf="!selectedCommunity || !selectedCommunity.energy_price || activeIndividual"
                                type="number" class="form-control number-input w-100"
                                [(ngModel)]="selectedCadastre.generationPrice" min="0">
                            <input *ngIf="selectedCommunity && selectedCommunity.energy_price && activeCommunity"
                                type="number" class="form-control number-input w-100"
                                [(ngModel)]="selectedCommunity.energy_price" min="0" disabled>
                        </div>
                    </div>

                    <div class="row mt-2 mt-md-4">
                        <span>Introdueix el consum mensual per periode. kWh.</span>
                    </div>

                    <div class="row mt-2 mt-md-4">
                        <div class="col-4">
                            <span class="form-label fs-6 smile-color">Vall</span>
                            <input type="number" class="form-control number-input w-100"
                                [(ngModel)]="selectedCadastre.valle" min="0" (change)="updateCadastreConsumption()">
                        </div>

                        <div class="col-4">
                            <span class="form-label fs-6 meh-color">Pla</span>
                            <input type="number" class="form-control number-input w-100"
                                [(ngModel)]="selectedCadastre.llano" min="0" (change)="updateCadastreConsumption()">
                        </div>

                        <div class="col-4">
                            <span class="form-label fs-6 frown-color">Punta</span>
                            <input type="number" class="form-control number-input w-100"
                                [(ngModel)]="selectedCadastre.punta" min="0" (change)="updateCadastreConsumption()">
                        </div>
                    </div>

                    <div class="row mt-2 mt-md-4">
                        <span>Introdueix el preu per periode. €/Kwh.</span>
                    </div>

                    <div class="row mt-2 mt-md-4">
                        <div class="col-4">
                            <span class="form-label smile-color fs-6">Vall</span>
                            <input type="number" class="form-control number-input w-100"
                                [(ngModel)]="selectedCadastre.vallePrice" (change)="updateConsumptions()">
                        </div>
                        <div class="col-4">
                            <span class="form-label meh-color fs-6">Pla</span>
                            <input type="number" class="form-control number-input w-100"
                                [(ngModel)]="selectedCadastre.llanoPrice" (change)="updateConsumptions()">
                        </div>
                        <div class="col-4">
                            <span class="form-label frown-color fs-6">Punta</span>
                            <input type="number" class="form-control number-input w-100"
                                [(ngModel)]="selectedCadastre.puntaPrice" (change)="updateConsumptions()">
                        </div>
                    </div>

                    <div class="d-flex justify-content-center">
                        <button type="button" class="btn btn-primary w-md-auto mt-2 mt-md-4 w-100"
                            style="max-width: 300px;"
                            (click)="editingArea=false; simulateGenerationConsumption()">Calcular </button>
                    </div>

                </div>

                <div *ngIf="!editingArea" class="row ps-0 m-0 pb-2 mt-4 row-cols-2 row-cols-md-4 row-cols-xl-5">

                    <!-- metres quadrats -->
                    <div class="col mb-2 mb-md-4">
                        <div>
                            <span>M² de l'àrea</span>
                        </div>
                        <div>
                            <input type="number" class="form-select number-input disabled"
                                [(ngModel)]="this.selectedCadastre.m2" (change)="updateCadastreChart()" min="0" step="0"
                                readonly>
                        </div>

                    </div>

                    <!-- n plaques -->
                    <div class="col mb-2 mb-md-4">
                        <div>
                            <span> Nº de plaques</span>
                        </div>
                        <div>
                            <input type="number" class="form-control number-input disabled"
                                [(ngModel)]="this.selectedCadastre.n_plaques" (change)="updateCadastreChart()" min="0"
                                step="0" disabled>
                        </div>
                    </div>

                    <!-- Anys per amortitzar -->
                    <div class="col mb-2 mb-md-4">

                        <div>
                            <span>Anys per amortitzar</span>
                        </div>

                        <div>
                            <input type="number" class="form-control number-input w-100" disabled readonly
                                [value]="this.selectedCadastre.redeemYears">
                        </div>

                    </div>

                    <!-- Cost inicial d'inversió -->
                    <div class="col mb-2 mb-md-4">

                        <div>
                            <span>Cost d'inversió</span>
                        </div>

                        <div>
                            <input type="number" class="form-control number-input w-100" readonly disabled
                                [value]="this.selectedCadastre.totalCost">
                        </div>

                    </div>

                    <!-- Estalvi mensual -->
                    <div class="col mb-2 mb-md-4">

                        <div>
                            <span>Estalvi mensual</span>
                        </div>

                        <div>
                            <input type="number" class="form-control number-input w-100" disabled readonly
                                [value]="this.selectedCadastre.monthlySavings">
                        </div>

                    </div>

                </div>

                <div class="d-flex w-100 mb-2 mb-md-2 mt-2 mt-md-4">
                    <div *ngIf="activeIndividual && !editingArea" class="custom-chart mx-auto"
                        style="width:95%; position:relative">
                        <app-chart [chartId]="'selectedCadastre'" [chartType]="selectedCadastreMonthChartType"
                            [labels]="monthChartLabels" [datasets]="selectedCadastreMonthChartDatasets"
                            [options]="communityMonthChartOptions"
                            [updateSubject]="updateSelectedCadastreMonthChartSubject.asObservable()"></app-chart>
                    </div>
                    <div *ngIf="activeCommunity && !editingArea" class="custom-chart mx-auto"
                        style="width:95%; position:relative">
                        <app-chart [chartId]="'selectedCadastreAcc'" [chartType]="selectedCadastreMonthChartType"
                            [labels]="monthChartLabels" [datasets]="selectedCadastreMonthChartDatasets"
                            [options]="communityMonthChartOptions"
                            [updateSubject]="updateSelectedCadastreMonthChartSubject.asObservable()"></app-chart>
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-2 mt-md-4 mb-2 mb-md-4 ">

                    <a class="d-flex" (click)="changeStep(4)" role="button">
                        <div class="arrow-left">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </div>
                        <span class="ms-2">Enrere</span>
                    </a>

                    <a class="d-flex" (click)="changeStep(6)" role="button">
                        <span class="me-2">Endavant</span>

                        <div class="arrow-right">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8" />
                            </svg>
                        </div>
                    </a>

                </div>
            </div>
        </div>

        <!-- ADD COMMUNITY DATA -->

        <div id="collapser-6" class="d-flex align-items-center w-100  mb-2 mb-md-4 collapser" (click)="changeStep(6)">

            <div class="p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive!=6 ? 'bi bi-chevron-right' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708" />
                </svg>

                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    [ngClass]="stepActive==6 ? 'bi bi-chevron-down' : 'd-none'" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />
                </svg>
            </div>

            <div [ngClass]="getStepClasses(6)">

                <div class="d-flex justify-content-between align-items-center w-100">

                    <span>
                        {{steps[5]}}
                    </span>

                    <!-- check step 5 -->
                    <div [ngClass]="stepsCompleted[5] ? 'd-block d-flex align-items-center' : 'd-none'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#229954"
                            class="bi bi-check-circle-fill success" viewBox="0 0 16 16">
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                        </svg>
                    </div>

                </div>

            </div>

        </div>

        <!-- ADD COMMUNITY COLAPSE -->

        <div class="collapse" id="collapse-area-add-step" [ngClass]="{'show':stepActive==6}">
            <div class="section-content-padding">

                <!-- <div *ngIf="!this.addedAreas.includes(this.selectedCadastre)"> -->
                <div *ngIf="this.selectedCadastre.monthlySavings && !this.addedAreas.includes(this.selectedCadastre)">

                    <span class="mb-2 mb-md-4">Dades completades! Fes clic a <b>Afegir comunitat</b> per a finalitzar.
                        Edita dades i
                        estadístiques més tard fent clic en <b>Dades i
                            estadístiques de la comunitat</b> o <b>Seleccionar àrea</b>.</span>

                    <div class="row justify-content-center">
                        <div class="col-12 col-md-4 col-lg-4 d-flex">
                            <button class="btn btn-secondary mt-4 w-100" (click)="addArea()">Afegir a la comunitat
                            </button>
                        </div>
                    </div>

                </div>


                <!-- todo: if selectedArea is addedArea : update button -->
                <div class="w-100 d-flex" *ngIf="this.addedAreas.includes(this.selectedCadastre)">
                    <button class="btn btn-secondary mt-4 w-100" (click)="addArea()">Actualitzar</button>
                </div>

                <div *ngIf="!this.selectedCadastre.monthlySavings">

                    <div class="mb-2 mb-md-4">
                        <span> Resum de dades afegides. Edita'ls sempre que vulguis fent clic a
                            <b>Seleccionar
                                àrea</b>.</span>
                    </div>

                    <div class="row mb-2 mb-md-4">

                        <div class="col-12 col-md-4">

                            <div class="mb-2 mb-md-4">
                                <span *ngIf="selectedLocation">Població:
                                    {{this.selectedLocation.municipality}}</span>
                            </div>

                            <div class="mb-2 mb-md-4">
                                <span *ngIf="!this.selectedCommunity || !this.selectedCommunity.name">Comunitat:
                                    Nova
                                    comunitat</span>

                                <span *ngIf="this.selectedCommunity && this.selectedCommunity.name">Comunitat:
                                    {{this.selectedCommunity.name}}</span>
                            </div>

                            <!-- <div class="mb-2 mb-md-4">
                                <span *ngIf="selectedLocation">Àrea :
                                    Àrea {{this.addedAreas.length}}</span>
                            </div> -->

                        </div>


                        <div class="col-12 col-md-4">

                            <div class="mb-2 mb-md-4">
                                <span *ngIf="selectedCommunity">Membres: {{ communityCups.length || 0 }}</span>
                            </div>

                            <div class="mb-2 mb-md-4">
                                <span class="">Membres simulats: {{ addedAreas.length }}</span>
                            </div>

                        </div>

                        <!-- <div class="col-12 col-md-4">

                            <div class="mb-2 mb-md-4">
                                <span *ngIf="this.addedAreas.length"> M² de l'àrea:
                                    {{this.addedAreas[this.addedAreas.length-1].m2}} </span>
                            </div>

                            <div class="mb-2 mb-md-4">
                                <span *ngIf="this.addedAreas.length">Nº de plaques:
                                    {{this.addedAreas[this.addedAreas.length-1].n_plaques}}</span>
                            </div>

                        </div>

                        <div class="col-12 col-md-4">

                            <div class="mb-2 mb-md-4">
                                <span *ngIf="this.addedAreas.length"> Estalvi mensual (€/mes):
                                    {{this.addedAreas[this.addedAreas.length-1].monthlySavings}} </span>
                            </div>

                            <div class="mb-2 mb-md-4">
                                <span *ngIf="this.addedAreas.length"> Cost inicial d'inversió (€):
                                    {{this.addedAreas[this.addedAreas.length-1].totalCost}} </span>
                            </div>

                            <div class="mb-2 mb-md-4">
                                <span *ngIf="this.addedAreas.length"> Anys per amortitzar:
                                    {{this.addedAreas[this.addedAreas.length-1].redeemYears}} </span>
                            </div>

                        </div> -->

                    </div>

                    <div class="d-flex w-100 mb-2 mb-md-2 mt-2 mt-md-4">
                        <div *ngIf="selectedCommunity && (selectedCommunity.cups_number || addedAreas.length)"
                            class="custom-chart mx-auto" style="width:95%; position:relative">
                            <app-chart [chartId]="'communityChart2'" [chartType]="communityMonthChartType"
                                [labels]="monthChartLabels" [datasets]="communityMonthChartDatasets"
                                [options]="communityMonthChartOptions"
                                [updateSubject]="communityUpdateMonthChartSubject.asObservable()"></app-chart>
                        </div>
                    </div>

                    <span class="fs-6 my-2" *ngIf="addedAreas.length">Llista d'agregats</span>
                    <div class="btn-light" style="max-height: 283px; overflow-y: auto; overflow-x: hidden;">
                        <div class="fs-6 my-2 row mt-3" *ngFor="let area of addedAreas; index as i"
                            style="max-height: 50px; overflow: hidden;">
                            <span class="col-3">Àrea {{ i+1 }}</span>
                            <button class="col-3 btn btn-secondary ms-2" type="button" (click)="editArea(i)">
                                Editar</button>
                            <button class="col-3 btn btn-danger ms-2" type="button" (click)="deleteArea(i)">
                                Esborrar</button>
                        </div>
                    </div>

                </div>


                <div class="d-flex justify-content-between mt-2 mt-md-4 mb-2 mb-md-4 ">

                    <a class="d-flex" (click)="changeStep(5)" role="button">
                        <div class="arrow-left">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-left" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                            </svg>
                        </div>
                        <span class="ms-2">Enrere</span>
                    </a>

                    <a class="d-flex">

                    </a>

                </div>
            </div>
        </div>

        <!-- end of colapse list -->

    </div>
</div>

<div class="footer-calculate  w-100 p-3">
    <div class="logo-zertifier-container d-flex justify-content-center">
        <a [routerLink]="['/']" class="navbar-brand text-center">
            <img src="assets/img/logos/zertifier-logo-white.svg" class="px-3" alt="zertipower-logo"
                style="width: 265px;">
        </a>
    </div>
    <div class="text-center text-white  d-flex justify-content-center mt-4">Zertifier 2024</div>
</div>